import{_ as F}from"./CommonBlurhash.vue.63c08ee4.js";import{d as q,a as b,c0 as G,x as I,c1 as H,S as W,c2 as X,al as Y,an as O,c3 as J,F as K,a6 as Q,bT as Z,o as v,c as f,h as n,j as m,bf as V,a3 as S,k as R,ab as _,f as T,w as z,t as U,a8 as ee,l as L,b2 as te}from"./entry.6470c283.js";var ae=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],C=e=>{let a=0;for(let i=0;i<e.length;i++){let r=e[i],d=ae.indexOf(r);a=a*83+d}return a},B=e=>{let a=e/255;return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)},D=e=>{let a=Math.max(0,Math.min(1,e));return a<=.0031308?Math.trunc(a*12.92*255+.5):Math.trunc((1.055*Math.pow(a,.4166666666666667)-.055)*255+.5)},ne=e=>e<0?-1:1,E=(e,a)=>ne(e)*Math.pow(Math.abs(e),a),N=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},oe=e=>{if(!e||e.length<6)throw new N("The blurhash string must be at least 6 characters");let a=C(e[0]),i=Math.floor(a/9)+1,r=a%9+1;if(e.length!==4+2*r*i)throw new N(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*r*i}`)},se=e=>{let a=e>>16,i=e>>8&255,r=e&255;return[B(a),B(i),B(r)]},le=(e,a)=>{let i=Math.floor(e/361),r=Math.floor(e/19)%19,d=e%19;return[E((i-9)/9,2)*a,E((r-9)/9,2)*a,E((d-9)/9,2)*a]},ie=(e,a,i,r)=>{oe(e),r=r|1;let d=C(e[0]),y=Math.floor(d/9)+1,j=d%9+1,P=(C(e[1])+1)/166,c=new Array(j*y);for(let s=0;s<c.length;s++)if(s===0){let h=C(e.substring(2,6));c[s]=se(h)}else{let h=C(e.substring(4+s*2,6+s*2));c[s]=le(h,P*r)}let w=a*4,g=new Uint8ClampedArray(w*i);for(let s=0;s<i;s++)for(let h=0;h<a;h++){let o=0,M=0,$=0;for(let u=0;u<y;u++)for(let p=0;p<j;p++){let A=Math.cos(Math.PI*h*p/a)*Math.cos(Math.PI*s*u/i),k=c[p+u*j];o+=k[0]*A,M+=k[1]*A,$+=k[2]*A}let x=D(o),t=D(M),l=D($);g[4*h+0+s*w]=x,g[4*h+1+s*w]=t,g[4*h+2+s*w]=l,g[4*h+3+s*w]=255}return g},re=ie;const ce=["gap"],he=["poster","controls","width","height"],ue=["src"],me={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},de=["poster","width","height"],ve=["src"],fe={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},ge={key:2,controls:"","h-15":""},pe=["src"],be={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:file-download-line":""},we={hidden:""},ye={p4:"",flex:"","flex-col":"","gap-2":"","max-w-130":""},Me={flex:"","justify-between":""},ke={"font-bold":"","text-xl":"","text-secondary":""},je={"text-sm":"","btn-outline":"",py0:"",px2:"","text-secondary":"","border-base":""},Pe={"whitespace-pre-wrap":""},Ae=q({__name:"StatusAttachment",props:{attachment:{},attachments:{},fullSize:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},setup(e){const a=b(()=>e.attachment.previewUrl||e.attachment.url||e.attachment.remoteUrl),i=b(()=>[[e.attachment.url,e.attachment.meta?.original?.width],[e.attachment.remoteUrl,e.attachment.meta?.original?.width],[e.attachment.previewUrl,e.attachment.meta?.small?.width]].filter(([t])=>t).map(([t,l])=>`${t} ${l}w`).join(", ")),r=b(()=>{if(e.attachment.meta?.original?.aspect)return e.attachment.meta.original.aspect;if(e.attachment.meta?.small?.aspect)return e.attachment.meta.small.aspect}),d=b(()=>{if(e.fullSize)return r.value;if(r.value)return G(r.value,.8,6)}),y=b(()=>{const t=e.attachment.meta?.focus?.x||0,l=e.attachment.meta?.focus?.y||0,u=(t/2+.5)*100,p=(l/-2+.5)*100;return`${u}% ${p}%`}),j={video:["mp4","webm","mov","avi","mkv","flv","wmv","mpg","mpeg"],audio:["mp3","wav","ogg","flac","aac","m4a","wma"],image:["jpg","jpeg","png","svg","webp","bmp"],gifv:["gifv","gif"]},P=b(()=>{if(e.attachment.type&&e.attachment.type!=="unknown")return e.attachment.type;for(const[t,l]of Object.entries(j))if(l.some(u=>a.value?.toLowerCase().endsWith(`.${u}`)))return t;return"unknown"}),c=I(),w=H(),g=b(()=>e.attachment.type==="audio"),s=W("enableAutoplay");X(c,t=>{const l=c.value?.dataset.ready==="true";if(w.value==="reduce"||!s.value){l&&!c.value?.paused&&c.value?.pause();return}t.forEach(u=>{u.intersectionRatio<=.75?l&&!c.value?.paused&&c.value?.pause():c.value?.play().then(()=>{c.value.dataset.ready="true"}).catch(te)})},{threshold:.75});const h=Y(),o=I(e.isPreview||!O(h.value,"enableDataSaving"));function M(){o.value=!0}const $=b(()=>{if(!e.attachment.blurhash)return"";const t=re(e.attachment.blurhash,32,32);return J(t,32,32)});let x=o.value?e.attachment.previewUrl:$.value;return K(o,()=>{x=o?e.attachment.previewUrl:$.value}),(t,l)=>{const u=F,p=Q("VDropdown"),A=Z("close-popper");return v(),f("div",{relative:"",ma:"",flex:"",gap:g.value?"2":""},[P.value==="video"?(v(),f("button",{key:0,type:"button",relative:"",onClick:l[0]||(l[0]=k=>n(o)?null:M())},[m("video",{ref_key:"video",ref:c,preload:"none",poster:n(x),muted:"",loop:"",playsinline:"",controls:n(o),"rounded-lg":"","object-cover":"","fullscreen:object-contain":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:V({aspectRatio:n(d),objectPosition:n(y)}),class:S(n(o)?"":"brightness-60 hover:brightness-70 transition-filter")},[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,ue)],14,he),n(o)?R("",!0):(v(),f("span",me))])):P.value==="gifv"?(v(),f("button",{key:1,type:"button",relative:"",onClick:l[1]||(l[1]=k=>n(o)?null:M())},[m("video",{ref_key:"video",ref:c,preload:"none",poster:n(x),muted:"",loop:"",playsinline:"","rounded-lg":"","object-cover":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:V({aspectRatio:n(d),objectPosition:n(y)})},[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,ve)],12,de),n(o)?R("",!0):(v(),f("span",fe))])):P.value==="audio"?(v(),f("audio",ge,[m("source",{src:t.attachment.url||t.attachment.previewUrl,type:"audio/mp3"},null,8,pe)])):(v(),f("button",{key:3,type:"button","focus:outline-none":"","focus:ring":"2 primary inset","rounded-lg":"","h-full":"","w-full":"","aria-label":"Open image preview dialog",relative:"",onClick:l[2]||(l[2]=k=>n(o)?("openMediaPreview"in t?t.openMediaPreview:n(_))(t.attachments?t.attachments:[t.attachment],t.attachments?.indexOf(t.attachment)||0):M())},[T(u,{blurhash:t.attachment.blurhash||"",class:S(["status-attachment-image",n(o)?"":"brightness-60 hover:brightness-70 transition-filter"]),src:a.value,srcset:i.value,width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,alt:t.attachment.description??"Image",style:V({aspectRatio:n(d),objectPosition:n(y)}),"should-load-image":n(o),"rounded-lg":"","h-full":"","w-full":"","object-cover":"",draggable:n(o)},null,8,["blurhash","src","srcset","width","height","alt","style","should-load-image","draggable","class"]),n(o)?R("",!0):(v(),f("span",be))])),t.attachment.description&&!("getPreferences"in t?t.getPreferences:n(O))(n(h),"hideAltIndicatorOnPosts")?(v(),f("div",{key:4,class:S(g.value?"":"absolute left-2 bottom-2")},[T(p,{distance:6,placement:"bottom-start"},{popper:z(()=>[m("div",ye,[m("div",Me,[m("h2",ke,U(t.$t("status.img_alt.desc")),1),ee((v(),f("button",je,[L(U(t.$t("status.img_alt.dismiss")),1)])),[[A]])]),m("p",Pe,U(t.attachment.description),1)])]),default:z(()=>[m("button",{"font-bold":"","text-sm":"",class:S(g.value?"rounded-full h-15 w-15 btn-outline border-base text-secondary hover:bg-active hover:text-active":"rounded-1 bg-black/65 text-white hover:bg-black px1.2 py0.2")},[m("div",we,U(t.$t("status.img_alt.read",[t.attachment.type])),1),L(" "+U(t.$t("status.img_alt.ALT")),1)],2)]),_:1})],2)):R("",!0)],8,ce)}}});export{Ae as _};
